---
title: "PeCorA" 
output: 
  html_document: 
    highlight: tango
---

<!--
%\VignetteEngine{knitr::rmarkdown} 
%\VignetteIndexEntry{PeCorA}
%\VignetteKeyword{MSnSet.utils} 
%\VignettePackage{MSnSet.utils}
-->

```{r setup}
# set global chunk options
library("knitr")
opts_chunk$set(size='tiny')
```

```{r env, message=FALSE, echo=FALSE, cache=FALSE, warning=FALSE}
library(MSnSet.utils)
library(ggplot2)

# Example MSnSet
data("PeCorA_msnset") # m
m # display summary
head(fData(m))
```

PeCorA will estimate the significance of interaction between the peptides
mapping to a protein and the treatment variable supplied.

```{r}
# proteins with peptides to test
proteins <- c("APOE", "BIN1")
m <- pecora_analysis(m,
                     treatment = "gpath_quantile",
                     proteins = proteins)
# Show fData for those proteins
head(fData(m)[fData(m)[["Protein"]] %in% proteins, ])
```

Running PeCorA again will add new results to fData.

```{r}
m <- pecora_analysis(m,
                     treatment = "gpath",
                     proteins = proteins,
                     median_mod = FALSE)
# Display part of results
head(fData(m)[fData(m)[["Protein"]] %in% proteins, ])
m <- pecora_analysis(m,
                     treatment = "gpath",
                     proteins = proteins,
                     median_mod = TRUE)
# Display part of results
head(fData(m)[fData(m)[["Protein"]] %in% proteins, ])
```

Finally, pecora_plot can plot a particular feature (peptide) against all other
peptides mapping to the same protein, and will include the adjusted p-value for
that peptide in the plot subtitle. Depending on the type of the treatment
variable (categorical vs. numeric) a boxplot or scatterplot is made,
respectively. The parameter `median_mod` can be set to `TRUE` to aggregate
(samplewise) all other peptides mapping to the same protein using the median.

```{r}
p1 <- plot_pecora(m, 
                  feature = "APOE@LGADMEDVCGR", 
                  treatment = "gpath", 
                  median_mod = FALSE)
p1
```

```{r}
p2 <- plot_pecora(m, 
                  feature = "APOE@LGADMEDVCGR", 
                  treatment = "gpath_quantile", 
                  median_mod = FALSE)
p2
```

Since this is a `ggplot` object, we can modify it as needed.

```{r}
# Change y-axis limits and theme
p3 <- p2 + 
  scale_y_continuous(limits = c(-1.05, 1)) +
  theme_bw()
p3
```


