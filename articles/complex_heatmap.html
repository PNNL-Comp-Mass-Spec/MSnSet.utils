<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Annotated Expression and Correlation Heatmaps • MSnSet.utils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Create Annotated Expression and Correlation Heatmaps">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MSnSet.utils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/complex_heatmap.html">Create Annotated Expression and Correlation Heatmaps</a>
    </li>
    <li>
      <a href="../articles/fuzzy_cmeans.html">Fuzzy C-Means</a>
    </li>
    <li>
      <a href="../articles/heatmap_examples.html">Heatmaps</a>
    </li>
    <li>
      <a href="../articles/heatmap.plus.2.html">heatmap.plus.2</a>
    </li>
    <li>
      <a href="../articles/id_conversion.html">ID Conversion</a>
    </li>
    <li>
      <a href="../articles/ontology_overrepresentation.html">Over-representation Analysis</a>
    </li>
    <li>
      <a href="../articles/PeCorA.html">PeCorA</a>
    </li>
    <li>
      <a href="../articles/peptide_mapping_example_1.html">Peptide Mapping Example 1</a>
    </li>
    <li>
      <a href="../articles/plot_sel_feat_with_p_vals.html">Example of MSnSet Feature Bar Chart with P-Value Coloring</a>
    </li>
    <li>
      <a href="../articles/wgcna_example.html">Example of WGCNA Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Create Annotated Expression and Correlation
Heatmaps</h1>
            
      

      <div class="hidden name"><code>complex_heatmap.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MSnSet.utils</span><span class="op">)</span> <span class="co"># complex_heatmap</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span> <span class="co"># colorRamp2</span></span>
<span></span>
<span><span class="co"># Data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"longitudinal_biomarker_study"</span><span class="op">)</span></span>
<span><span class="co"># Shorten name</span></span>
<span><span class="va">ee</span> <span class="op">&lt;-</span> <span class="va">longitudinal_biomarker_study</span></span></code></pre></div>
<div class="section level2">
<h2 id="expression-heatmaps">Expression Heatmaps<a class="anchor" aria-label="anchor" href="#expression-heatmaps"></a>
</h2>
<p>A heatmap of the <code>exprs</code> slot of an <code>eSet</code> or
<code>MSnSet</code> object with features as rows and samples as columns.
The rows can be annotated with columns in <code>fData</code> and the
columns can be annotated with columns in <code>pData</code>.</p>
<p>Prior to heatmap creation, the MSnSet should be put through a
missingness filter. This is because if there is a high degree of
missingness, clustering may fail. The alternative is to set
<code>cluster_rows</code> (and possible <code>cluster_columns</code>) to
<code>FALSE</code>. This is rarely necessary if creating correlation
heatmaps, as the correlation matrix will have few, if any, missing
values.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only keep features identified in at least 50% of samples</span></span>
<span><span class="va">ee</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ee</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.5</span>, <span class="op">]</span></span></code></pre></div>
<p>Now, we can make the heatmap. For matrices with thousands of rows,
this may take a while. By default, neither sample nor feature names are
displayed, but this can be changed with the
<code>show_column_names</code> and <code>show_row_names</code>
arguments, respectively.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>Due to the wide range of values, it is difficult to see color
differences. We can fix this by setting limits on the range of the color
scale. This does not affect the actual data: just the colors of the
heatmap body. We will limit colors to (-1.5, 1.5). Values below -1.5
will be the same shade of blue, and values above 1.5 will be the same
shade of red.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, color_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="sample-correlation-heatmaps">Sample Correlation Heatmaps<a class="anchor" aria-label="anchor" href="#sample-correlation-heatmaps"></a>
</h2>
<p>Sample correlation heatmaps are generated by setting
<code>heatmap_type</code> to (an abbreviation of)
<code>"sample_correlation"</code> such as <code>"s"</code>. This will
calculate the matrix of correlations between samples using the method
specified by <code>cor_method</code> and use this to generate a heatmap
with samples as both rows and columns. For sample correlation heatmaps,
only <code>anno_column</code> may be specified, and both rows and
columns are annotated the same way.</p>
<p>Sample correlation heatmaps are generally more useful when we have
sample labels, so it is usually a good idea to set
<code>show_rownames</code> and <code>show_colnames</code> to
<code>TRUE</code>. If there are too many samples to see labels in the
plot window, consider saving the heatmap to a file with appropriate
values for <code>filename</code>, <code>height</code> and
<code>width</code> to view the labels more easily.</p>
<p>We will create a sample correlation heatmap and annotate rows and
columns with the <code>"Plate"</code> column of
<code>pData(ee)</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, heatmap_type <span class="op">=</span> <span class="st">"sample"</span>, anno_column <span class="op">=</span> <span class="st">"Plate"</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="feature-correlation-heatmaps">Feature Correlation Heatmaps<a class="anchor" aria-label="anchor" href="#feature-correlation-heatmaps"></a>
</h2>
<p>Similar to the sample correlation heatmaps, but displays the
correlations between <em>features</em> (proteins, peptides, etc.). Only
<code>anno_row</code> may be specified, and both rows and columns are
annotated the same way.</p>
<p>We will create a feature correlation heatmap and annotate rows and
columns with the <code>"isSpike"</code> column of
<code>fData(ee)</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, heatmap_type <span class="op">=</span> <span class="st">"feature"</span>, anno_row <span class="op">=</span> <span class="st">"isSpike"</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="row-and-column-annotation">Row and Column Annotation<a class="anchor" aria-label="anchor" href="#row-and-column-annotation"></a>
</h2>
<p>To annotate columns and rows of the heatmap, we use the
<code>anno_column</code> and <code>anno_row</code> arguments,
respectively. <code>anno_column</code> takes a vector of one or more
strings that correspond to the names of columns in <code>pData</code>,
and <code>anno_row</code> takes a vector of one or more strings that
correspond to the names of column in <code>fData</code>. By default,
<code><a href="../reference/colorschemes.html">MSnSet.utils::jet2.colors</a></code> is used for character, factor,
and logical values, and <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">circlize::colorRamp2</a></code> with a viridis
color palette is used for numeric values.</p>
<p>We will annotate the rows using values in the <code>"isSpike"</code>
(logical) column of <code>fData(ee)</code> and annotate rows using the
values in the <code>"Type"</code> (factor) and <code>"Age"</code>
(numeric) columns of <code>pData(ee)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expression heatmap with annotated rows and columns</span></span>
<span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, anno_row <span class="op">=</span> <span class="st">"isSpike"</span>, anno_column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>, <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<div class="section level3">
<h3 id="modifying-annotation-colors">Modifying Annotation Colors<a class="anchor" aria-label="anchor" href="#modifying-annotation-colors"></a>
</h3>
<p>We can change the colors of row and column annotations by passing
lists to <code>anno_row_colors</code> and
<code>anno_column_colors</code> respectively. For example, we will
change the colors of <code>"Type"</code> so that “Control” is a
different shade of blue (“#414DBE”) and “Case” is a dark yellow
(#BEB241). We only need to supply a list with new colors for
<code>"Type"</code>.</p>
<p><strong>Tip:</strong> Use the RColorBrewer package, an interactive
color wheel (like
<a href="https://www.canva.com/colors/color-wheel/" class="external-link">this one from
canva</a>), or a color palette generator (like
<a href="https://www.canva.com/colors/color-palette-generator/" class="external-link">this one
that is also from canva</a>) to easily find the right colors.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Modify colors for categorical variables</span></span>
<span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, anno_column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>, <span class="st">"Age"</span><span class="op">)</span>,</span>
<span>                anno_column_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#414DBE"</span>, <span class="st">"#BEB241"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>Notice that the colors for <code>"Age"</code> are not changed. For
continuous colors, we need to use <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">circlize::colorRamp2</a></code>. See
documentation page for how to use this function. Any number of breaks
can be provided, as long as the number of colors is the same. For this
example, we will use a sequential color scale that goes from white to
green for <code>"Age"</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Modify colors for continuous variables</span></span>
<span><span class="fu"><a href="../reference/complex_heatmap.html">complex_heatmap</a></span><span class="op">(</span><span class="va">ee</span>, anno_column <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>, <span class="st">"Age"</span><span class="op">)</span>,</span>
<span>                anno_column_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ee</span><span class="op">[[</span><span class="st">"Age"</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                                   colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_heatmap_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Vladislav Petyuk.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
